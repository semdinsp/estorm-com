Needs["dmdash`"]; 
month = ToString[Take[StringSplit[DateString[]], {3, 4}]]; 
results = estormdash`getRawWallets[]; 
{header, rows} = dmdash`fileparse[results];
rows = DeleteCases[rows, {""}];
rows = Sort[rows, Sort[{#1[[4]], #2[[4]]}] == {#1[[4]], #2[[4]]} &];
allrows = rows;
rows = Select[rows, #[[7]] > 1 &]; 
(* current reve > 0 *)day = DateList[][[3]];
createDMAssociation[day_, rows_List, allrows_List] := 
  Module[{assoc}, 
   assoc = <|"day" -> day, "rows" -> rows, "allrows" -> allrows|>;
   assoc];
Needs["dreamUtilities`"];
vals = createDMAssociation[day, rows, allrows];
grid = dmdash`dmAvailableCredit[
   Select[rows, #[[7]] > 0.5 && #[[1]]/(#[[7]]/day) < 2 &], day] ;
grid2 = dmdash`dmWalletReview[rows];
grid3 = dmdash`dmAvailableCredit[rows, day] ;
cc = {"eka.mardiarti@estormtech.com", "henricos@estormtech.com", 
   "emiliana@estormtech.com", "helio@estormtech.com", 
   "scott.sproule@estormtech.com"};
to = {"belo@estormtech.com", "antonio.quelo@estormtech.com", 
   "miki@estormtech.com", "joao@estormtech.com", "ldecosta@estormtech.com",
   "tsantos@estormtech.com"};
fragments = {Style[
    StringJoin["Immediate action required: ", DateString[]], Blue], 
   grid, Style["Low balance", Blue], grid2, 
   Style["All wallets cash days left", Blue], grid3, closingData[]};
estormAWSSendEmail[to, cc, {}, "Wallets Requiring Action", 
 combineHTMLFragments[fragments]];
Quit[];
