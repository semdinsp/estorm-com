Needs["estormdash`"]; 
Needs["dmdash`"]; 
processTime[rows_List] :=  Module[{newrows}, 
  newrows = {StringTake[#[[3]], 10], #[[6]]} & /@ rows; newrows];
getSmsReport[app_String, lastmonth_String] := 
  Module[{report, header, rows, gathered, gmap, grid},
   report = getRawSmsReport[app, lastmonth];
   header = report[[1]];
   rows = report[[3 ;;]];
   gathered = Gather[processTime[rows]];
   gmap = 
    Map[{gathered[[#, 1, 1]], Total[gathered, {2}][[#, 2]]} &, 
     Table[i, {i, 1, Length[gathered]}]];
   grid = 
    Grid[Prepend[{#[[1]], #[[2]]} & /@ gmap, {"Date",   "$ Value"}], 
     Frame -> All, Background -> {None, {LightBlue, {LightYellow}}}];
   {grid, header, rows, gmap}];

name = "SantaSms";
frags = {};
{grid, header, rows, gmap} = getSmsReport[name, "false"];
frags = Append[
   frags, {Style[
     StringJoin[name, " Report This Month: $", 
      ToString[Total[gmap][[2]]]], Blue], grid}];
{grid, header, rows, gmap} = 
 getSmsReport[name, "true"];  (*last month *)
frags = 
 Append[frags, {Style[
    StringJoin[name, " Report Last Month: $", 
     ToString[Total[gmap][[2]]]], Blue], grid}];
frags = Append[frags, closingData[]];

to = {"febby@estormtech.com", "helio@estormtech.com"};
cc = {"eka.mardiarti@estormtech.com", "scott.sproule@estormtech.com", 
   "emiliana@estormtech.com"};

estormAWSSendEmail[to, cc, {}, "Santa SMS Report", 
  combineHTMLFragments[Flatten[frags]]];
Quit[];